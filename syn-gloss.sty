% Henrison Hsieh's syntax and glossing package
% TODO: Maybe split up the syntax and the glossing portions
\ProvidesPackage{syn-gloss}

\NeedsTeXFormat{LaTeX2e}

\RequirePackage[T1]{fontenc}
\RequirePackage{tikz-qtree}
\RequirePackage{multicol}
\RequirePackage{xspace}
\RequirePackage{setspace}
\RequirePackage[normalem]{ulem}
\RequirePackage{textcomp}
\RequirePackage{amssymb}
\RequirePackage{leipzig}

\newif\if@single \@singlefalse
\DeclareOption{single}{\@singletrue}
\DeclareOption{double}{\@singlefalse}

\newif\if@expex \@expexfalse
\DeclareOption{expex}{\@expextrue}

\ExecuteOptions{single}
\ProcessOptions\relax

\newcommand{\glp}[3][ ]{\textit{#2}#1`#3'}
\newcommand{\extitle}[1]{\textbf{#1}}

% Abbreviations listing
\newcommand{\abrsep}{$=$}
\newcommand{\abr}{\@ifstar\@abr\@@abr}
\newcommand{\@@abr}[2]{\g{#1}~\abrsep~#2,}
\newcommand{\@abr}[2]{\g{#1}~\abrsep~#2}

% Example Macros
\newcommand{\exsep}{\vspace{0.5em}}
\newcommand{\g}[1]{\textsc{#1}}
\newcommand{\ix}[1]{{\footnotesize<}#1{\footnotesize>}}
\newcommand{\gix}[1]{\g{\ix{#1}}}
\newcommand{\blank}[1]{\uline{\phantom{#1}}\xspace}
\renewcommand{\*}{\textasciitilde} % reduplication
\newcommand{\+}{\textasciitilde} % reduplication

% Line Drawing Macros
\newcommand{\regline}[5][]{% {node1}{x1,y1}{x2,y2}{node2}
  \draw[->,#1] (#2).. controls +(#3) and +(#4) ..(#5);
}
\newcommand{\labelline}[6][above,sloped]{% {node1}{x1,y1}{x2,y2}{node2}
  \draw[->,dashed] (#2).. controls +(#3) and +(#4) ..
    node[#1] {\footnotesize#6} (#5);
}
\newcommand{\helpline}[4]{
  \regline{#1}{#2}{#3}{#4}
  \fill[color=red]  (#1) circle (2pt)  (#4) circle (2pt);
  \fill[color=blue] (#1)+(#2) circle (2pt) (#4)+(#3) circle (2pt);
}
% Allows tree labels to break across multiple lines
\newcommand{\treebr}{\tikzset{every tree node/.style={align=center,anchor=north}}}

% X-bar Annotation Macros
\newcommand{\xpsub}[1]{$_{\textrm{\scriptsize #1}}$}
\newcommand{\xbar}[1]{#1$'$}
\newcommand{\xhead}[1]{#1\textsuperscript{0}}

% Counter and macro for running footnote example numbering
\newcounter{FootnoteExample}
\renewcommand{\theFootnoteExample}{\roman{FootnoteExample}}

\newleipzig{av}{av}{Agent Voice}
\newleipzig{pv}{pv}{Patient Voice}
\newleipzig{lv}{lv}{Locative Voice}
\newleipzig{cv}{cv}{Circumstantial Voice}
\newleipzig{rv}{reason}{``Reason'' Voice}
\newleipzig{an}{an}{Agent Nominalization}
\newleipzig{pn}{pn}{Patient Nominalization}
\newleipzig{ln}{ln}{Locative Nominalization}
\newleipzig{lk}{lk}{Linker}
\newleipzig{stat}{stat}{Stative}
\newleipzig{ay}{ay}{Predicate Inversion}
\newleipzig{ger}{ger}{Gerund}
\newleipzig{exis}{exis}{Existential}
\newleipzig{nvol}{nvol}{Non-volitive Form}
\newleipzig{med}{med}{Medial}
\newcommand{\Um}{\@ifstar\@Um\@@Um}
\newcommand{\@@Um}{\ix{\Av}}
\newcommand{\@Um}{\ix{\Av.\Pfv}}
\newcommand{\Nag}{\Av.\Pfv}
\newcommand{\In}{\ix{\Pfv}}

\newcommand{\Ang}{\Nom}
\newcommand{\Ng}{\Gen}
\newcommand{\Sa}{\Obl}

\newcommand{\Ako}{\Fsg.\Ang}  \newcommand{\Kami}{\Fpl.\Excl.\Ang}
                              \newcommand{\Tayo}{\Fpl.\Incl.\Ang}
\newcommand{\Ko}{\Fsg.\Ng}    \newcommand{\Namin}{\Fpl.\Excl.\Ng}
                              \newcommand{\Natin}{\Fpl.\Incl.\Ng}
\newcommand{\Akin}{\Fsg.\Sa}  \newcommand{\Amin}{\Fpl.\Excl.\Sa}
                              \newcommand{\Atin}{\Fpl.\Incl.\Sa}
\newcommand{\Ka}{\Ssg.\Ang}   \newcommand{\Kayo}{\Spl.\Ang}
\newcommand{\Ikaw}{\Ka}
\newcommand{\Mo}{\Ssg.\Ng}    \newcommand{\Ninyo}{\Spl.\Ng}
\newcommand{\Iyo}{\Ssg.\Sa}   \newcommand{\Inyo}{\Spl.\Sa}
\newcommand{\Siya}{\Tsg.\Ang} \newcommand{\Sila}{\Tpl.\Ang}
\newcommand{\Niya}{\Tsg.\Ng}  \newcommand{\Nila}{\Tpl.\Ng}
\newcommand{\Kanya}{\Tsg.\Sa} \newcommand{\Kanila}{\Tpl.\Sa}

\if@expex
  \RequirePackage{expex}
  \lingset{
    everygla=,
    everyglb=\small,
    belowexskip=!-2ex,
    aboveexskip=!-2ex,
    interpartskip=!-0.75ex,
    aboveglftskip=-0.75ex,
    belowpreambleskip=0pt}
  \definelingstyle{footnote}{
    everyglb=,
    labeloffset=0.6em,
    textoffset=0.6em,
    exnotype=roman}
  \let\oldfootnote\footnote
  \renewcommand{\footnote}[1]{\oldfootnote{%
    \keepexcntlocal%
    \excnt=1%
    \lingset{lingstyle=footnote}%
    #1
  }}
\else % Use gb4e
  \RequirePackage{gb4e}
  \noautomath % Disable gb4e automath
  \let\eachwordtwo=\small   % Gloss-Level
  \let\eachwordthree=\small % Gloss-Level if Morpheme Level is present

  \newcommand{\gls}[2][]{\glt{`#2'\hfill\textit{#1}}}
  \newcommand{\gli}[2][]{\glt{Intended: `#2'#1}}
  \newcommand{\glf}[3][]{\glt{`#2'\footnote{#3}\hfill\textit{#1}}}

  %%%%%% Tweaking of the exe environment %%%%%%
  \if@single
    \newenvironment{exxe}[1][(234)]{
      \begin{multicols}{2}
      \begin{exe}[#1]
    }{
      \end{exe}
      \end{multicols}
    }
  \else
    % Automatically sets single spacing for examples.
    \let\oldexe\exe
    \def\exe{\oldexe \singlespacing}
    \newenvironment{exxe}[1][(234)]{
      \begin{multicols}{2}
      \begin{oldexe}[#1]
      \singlespacing
    }{
      \end{list}
      \end{oldexe}
      \end{multicols}
    }
    \newcommand{\fnex}{\@ifstar\@fnex\@@fnex}
    \newcommand{\@@fnex}[1]{%
      \refstepcounter{FootnoteExample}%
      \exi{(\theFootnoteExample)}{#1}%
    }
    \newcommand{\@fnex}[2]{%
      \refstepcounter{FootnoteExample}%
      \exi{(\theFootnoteExample)}[#1]{#2}%
    }
  \fi
\fi

% Some auxiliary judgement annotations (requires amssymb)
\newcommand{\ok}{\textsuperscript{\checkmark\hspace{-2pt}}}
\newcommand{\eh}{\textsuperscript{?}}

\endinput
