% Henrison Hsieh's syntax and glossing package
% TODO: Maybe split up the syntax and the glossing portions
\ProvidesPackage{syn-gloss}

\NeedsTeXFormat{LaTeX2e}

\RequirePackage[T1]{fontenc}
\RequirePackage{tikz-qtree}
\RequirePackage{multicol}
\RequirePackage{xspace}
\RequirePackage{setspace}
\RequirePackage[normalem]{ulem}
\RequirePackage{textcomp}
\RequirePackage{amssymb}

\newif\if@single \@singlefalse
\DeclareOption{single}{\@singletrue}
\DeclareOption{double}{\@singlefalse}

\newif\if@expex \@expexfalse
\DeclareOption{expex}{\@expextrue}

\ExecuteOptions{single}
\ProcessOptions\relax

\newcommand{\glp}[3][ ]{\textit{#2}#1`#3'}

% Abbreviations listing
\newcommand{\abrsep}{$=$}
\newcommand{\abr}{\@ifstar\@abr\@@abr}
\newcommand{\@@abr}[2]{\g{#1}~\abrsep~#2,}
\newcommand{\@abr}[2]{\g{#1}~\abrsep~#2}

% Example Macros
\newcommand{\exsep}{\vspace{0.5em}}
\newcommand{\g}[1]{\textsc{#1}}
\newcommand{\ix}[1]{{\footnotesize<}#1{\footnotesize>}}
\newcommand{\gix}[1]{\g{\ix{#1}}}
\newcommand{\bl}[1][~~~~~~~~]{\uline{#1}\xspace}
\renewcommand{\*}{\raise.17ex\hbox{$\scriptstyle\mathtt{\sim}$}} % "~" hack

% Line Drawing Macros
\newcommand{\regline}[5][]{% {node1}{x1,y1}{x2,y2}{node2}
  \draw[->#1] (#2).. controls +(#3) and +(#4) ..(#5);
}
\newcommand{\helpline}[4]{
  \regline{#1}{#2}{#3}{#4}
  \fill[color=red]  (#1) circle (2pt)  (#4) circle (2pt);
  \fill[color=blue] (#1)+(#2) circle (2pt) (#4)+(#3) circle (2pt);
}
% Allows tree labels to break across multiple lines
\newcommand{\treebr}{\tikzset{every tree node/.style={align=center,anchor=north}}}

% X-bar Annotation Macros
\newcommand{\xpsub}[1]{$_{\textrm{\scriptsize #1}}$}
\newcommand{\xbar}[1]{#1$'$}
\newcommand{\xhead}[1]{#1\textdegree}

\if@expex
  \RequirePackage{expex}
  \lingset{everyglb=\small,
           belowexskip=!-2ex,
           aboveexskip=!-2ex,
           interpartskip=!-0.75ex,
           aboveglftskip=-0.75ex,
           belowpreambleskip=0pt}
\else % Use gb4e
  \RequirePackage{gb4e}
  \noautomath % Disable gb4e automath
  \let\eachwordtwo=\small   % Gloss-Level
  \let\eachwordthree=\small % Gloss-Level if Morpheme Level is present

  \newcommand{\gls}[2][]{\glt{`#2'\hfill\textit{#1}}}
  \newcommand{\gli}[2][]{\glt{Intended: `#2'#1}}
  \newcommand{\glf}[3][]{\glt{`#2'\footnote{#3}\hfill\textit{#1}}}

  %%%%%% Tweaking of the exe environment %%%%%%
  \if@single
    \newenvironment{exxe}[1][(234)]{
      \begin{multicols}{2}
      \begin{exe}[#1]
    }{
      \end{exe}
      \end{multicols}
    }
  \else
    % Automatically sets single spacing for examples.
    % May screw up optional arguments for this environment, though.
    % Will cause the exxe command to not work properly...
    \let\oldexe\exe
    \def\exe{\oldexe \singlespacing}
    \newenvironment{exxe}[1][(234)]{
      \begin{multicols}{2}
      \begin{oldexe}[#1]
      \singlespacing
    }{
      \end{list}
      \end{oldexe}
      \end{multicols}
    }
  \fi
\fi

% Counter and macro for running footnote example numbering
\newcounter{FootnoteExample}
\renewcommand{\theFootnoteExample}{\roman{FootnoteExample}}
\newcommand{\fnex}{\@ifstar\@fnex\@@fnex}
\newcommand{\@@fnex}[1]{%
  \refstepcounter{FootnoteExample}%
  \exi{(\theFootnoteExample)}{#1}%
}
\newcommand{\@fnex}[2]{%
  \refstepcounter{FootnoteExample}%
  \exi{(\theFootnoteExample)}[#1]{#2}%
}


% Some auxiliary judgement annotations (requires amssymb)
\newcommand{\ok}{\textsuperscript{\checkmark\hspace{-2pt}}}
\newcommand{\eh}{\textsuperscript{?}}

\endinput
